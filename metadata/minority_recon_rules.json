[
  {
    "id": "core_system_minority_rule",
    "system": "core_system",
    "metric": "minority_category",
    "target_entity": "customer",
    "target_grain": ["customer_id"],
    "labels": ["minority", "demographics", "core_system"],
    "computation": {
      "description": "Derive minority category from customer_ind_info.minority_code joined to picklist_type_data (type_code=190) to get minority_desc",
      "source_entities": ["customer", "lookup"],
      "attributes_needed": {
        "customer": ["customer_id", "minority_code"],
        "lookup": ["data_code", "data_description", "type_code"]
      },
      "formula": "picklist_type_data.data_description",
      "aggregation_grain": ["customer_id"],
      "source_table": "customer_accounts",
      "filter_conditions": {
        "customer_accounts.is_active": "1",
        "customer_ind_info.is_active": "1",
        "picklist_type_data.is_active": "true",
        "picklist_type_data.type_code": "190"
      },
      "note": "Joins: customer_accounts -> customer_ind_info (on customer_id) -> picklist_type_data (on minority_code = data_code AND type_code = 190)"
    }
  },
  {
    "id": "los_system_social_category_rule",
    "system": "los_system",
    "metric": "social_category",
    "target_entity": "customer",
    "target_grain": ["cif"],
    "labels": ["social_category", "los", "los_system"],
    "computation": {
      "description": "Social category from LOS system asset_sourcing_personal_details_v2 table",
      "source_entities": ["customer"],
      "attributes_needed": {
        "customer": ["cif", "social_category"]
      },
      "formula": "social_category",
      "aggregation_grain": ["cif"],
      "source_table": "asset_sourcing_personal_details_v2",
      "filter_conditions": {
        "cif": "IS NOT NULL",
        "social_category": "IS NOT NULL"
      }
    }
  }
]

