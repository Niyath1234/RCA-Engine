[
  {
    "id": "test_loan_exclusion",
    "description": "Exclude test loans from reconciliation",
    "condition": {
      "table": "khatabook_loans",
      "filter": "loan_id LIKE 'TEST%'"
    },
    "applies_to": ["khatabook_tos"]
  },
  {
    "id": "writeoff_handling",
    "description": "Handle writeoff loans differently",
    "condition": {
      "table": "tb_loan_summary",
      "filter": "status = 'WRITEOFF'"
    },
    "applies_to": ["tb_tos"],
    "override": {
      "tos": 0
    }
  },
  {
    "id": "paid_amount_tolerance",
    "description": "When comparing paid amounts between collections_mis and outstanding_daily, allow small differences. If amounts differ by less than 0.01 or less than 0.01 percent, consider them matching.",
    "condition": {
      "table": "reconciliation",
      "filter": "amount_tolerance: absolute 0.01 or relative 0.01%"
    },
    "applies_to": ["collections_mis_paid_extraction", "outstanding_daily_paid_extraction"]
  },
  {
    "id": "paid_date_tolerance",
    "description": "When comparing paid dates between collections_mis and outstanding_daily, allow 1 day difference. This accounts for timezone differences or processing delays.",
    "condition": {
      "table": "reconciliation",
      "filter": "date_tolerance: 1 day difference allowed"
    },
    "applies_to": ["collections_mis_paid_extraction", "outstanding_daily_paid_extraction"]
  },
  {
    "id": "null_paid_date_exception",
    "description": "If a record doesn't have a paid date in either system, don't include it in the reconciliation comparison.",
    "condition": {
      "table": "reconciliation",
      "filter": "exclude records where paid_date is null"
    },
    "applies_to": ["collections_mis_paid_extraction", "outstanding_daily_paid_extraction"]
  }
]

